POR_overseas_provinces = {

	POR_angola_overseas_province = {

		icon = infiltrate_state

		available = {
			
			has_completed_focus = POR_luso_tropicalism
			AND = {
				POR = {
					controls_state = 540
					controls_state = 796
					controls_state = 891
					controls_state = 892
				}
				ANG = { exists = no }
			}
		}

		cost = 0
		fire_only_once = yes
		days_remove = 730
		ai_will_do = {
			factor = 2
		}
		modifier = {
			political_power_gain = -0.2
		}
		visible = {
			has_completed_focus = POR_luso_tropicalism
		}
		remove_effect = {
			country_event = lar_portugal_overseas_provinces.1
		}		
	}

	POR_mozambique_overseas_territory = {

		icon = infiltrate_state

		available = {
			has_completed_focus = POR_luso_tropicalism
			AND = {
				POR = {
					controls_state = 544
					controls_state = 896
					controls_state = 897
				}
				MZB = { exists = no }
			}
		}

		cost = 0
		fire_only_once = yes
		days_remove = 730
		ai_will_do = {
			factor = 2
		}

		modifier = {
			political_power_gain = -0.2
		}
		
		visible = {
			has_completed_focus = POR_luso_tropicalism
		}
		remove_effect = {			
			country_event = lar_portugal_overseas_provinces.2
		}
	}	
}

POR_arms_purchases = {

	POR_buy_artillery_in_britain = { 

		icon = generic_industry

		available = {
			ENG = {
				has_opinion = {
					target = ROOT
					value > 0
				}
			}
		}

		cost = 0
		days_remove = 90
		days_re_enable = 90
		ai_will_do = {
			factor = 0.1
			modifier = {
				OR = {
					num_of_civilian_factories < 5
					stockpile_ratio = { 
		  				archetype = artillery_equipment
		  				ratio > 3
		  			}
				}
				factor = 0
			}
			modifier = {
				has_war = yes
				factor = 10
			}
		}
		modifier = {
			civilian_factory_use = 1
		}
		visible = {
			has_completed_focus = POR_british_guns
			NOT = {
				has_war_with = ENG
			}
			country_exists = ENG
		}
		complete_effect = {
			ENG = {
				add_offsite_building = {
					type = industrial_complex
					level = 1
				}
				add_opinion_modifier = {
					target = POR
					modifier = POR_bought_guns
				}

			}
			add_opinion_modifier = {
				target = ENG
				modifier = POR_sold_guns
			}
			add_opinion_modifier = {
				target = ENG
				modifier = POR_arms_trade
			}
		}
		remove_effect = {
			add_equipment_to_stockpile = {
				type = artillery_equipment
				amount = 100
				producer = ENG
			}
			ENG = {
				add_offsite_building = {
					type = industrial_complex
					level = -1
				}
			}
		}
	}
	POR_buy_aa_in_britain = { 

		icon = generic_industry

		available = {
			ENG = {
				has_opinion = {
					target = ROOT
					value > 0
				}
				has_tech = interwar_antiair
			}
		}

		cost = 0
		days_remove = 90
		days_re_enable = 90
		ai_will_do = {
			factor = 0.1
			modifier = {
				OR = {
					num_of_civilian_factories < 5
					stockpile_ratio = { 
		  				archetype = anti_air_equipment
		  				ratio > 3
		  			}
				}
				factor = 0
			}
			modifier = {
				has_war = yes
				factor = 10
			}
		}
		modifier = {
			civilian_factory_use = 1
		}
		visible = {
			has_completed_focus = POR_british_guns
			NOT = {
				has_war_with = ENG
			}
			country_exists = ENG
		}
		complete_effect = {
			ENG = {
				add_offsite_building = {
					type = industrial_complex
					level = 1
				}
				add_opinion_modifier = {
					target = POR
					modifier = POR_bought_guns
				}
			}
			add_opinion_modifier = {
				target = ENG
				modifier = POR_sold_guns
			}
			add_opinion_modifier = {
				target = ENG
				modifier = POR_arms_trade
			}
		}
		remove_effect = {
			add_equipment_to_stockpile = {
				type = anti_air_equipment
				amount = 100
				producer = ENG
			}
			ENG = {
				add_offsite_building = {
					type = industrial_complex
					level = -1
				}
			}
		}
	}

	POR_buy_at_in_britain = { 

		icon = generic_industry

		available = {
			ENG = {
				has_opinion = {
					target = ROOT
					value > 0
				}
				has_tech = interwar_antitank
			}
		}

		cost = 0
		days_remove = 90
		days_re_enable = 90
		ai_will_do = {
			factor = 0.1
			modifier = {
				OR = {
					num_of_civilian_factories < 5
					stockpile_ratio = { 
		  				archetype = anti_tank_equipment
		  				ratio > 3
		  			}
				}
				factor = 0
			}
			modifier = {
				has_war = yes
				factor = 10
			}
		}
		modifier = {
			civilian_factory_use = 1
		}
		visible = {
			has_completed_focus = POR_british_guns
			NOT = {
				has_war_with = ENG
			}
			country_exists = ENG
		}
		complete_effect = {
			ENG = {
				add_offsite_building = {
					type = industrial_complex
					level = 1
				}
				add_opinion_modifier = {
					target = POR
					modifier = POR_bought_guns
				}
			}
			add_opinion_modifier = {
				target = ENG
				modifier = POR_sold_guns
			}
			add_opinion_modifier = {
				target = ENG
				modifier = POR_arms_trade
			}
		}
		remove_effect = {
			add_equipment_to_stockpile = {
				type = anti_tank_equipment
				amount = 100
				producer = ENG
			}
			ENG = {
				add_offsite_building = {
					type = industrial_complex
					level = -1
				}
			}
		}
	}

	POR_buy_ships_britain = {

		icon = eng_trade_unions_support

		available = {
			ENG = {
				has_war = no
				has_opinion = {
					target = ROOT
					value > 0
				}
			}
		}

		cost = 0

		ai_will_do = {
			base = 10
			modifier = {
				factor = 5
				ENG = { has_government = ROOT }
				NOT = { has_government = fascism }
			}
			modifier = {
				factor = 0
				has_country_flag = POR_ships_purchase_timer
			}
			modifier = {
				factor = 0
				has_government = fascism
				ENG = { 
					NOT = { 
						has_government = fascism 	 
					}
				}
			}
		}
		
		visible = {
			has_completed_focus = POR_second_navy_reequipment
			ENG = {
				exists = yes
				NOT = { has_war_with = ROOT }
				has_civil_war = no
				has_capitulated = no
				owns_state = 126 #Owns London
			}
			NOT = {	has_country_flag = POR_ships_purchase_in_progress_flag }
			NOT = { has_country_flag = POR_british_ships_purchase_rejected_flag }
		}
		complete_effect = {
			ENG = {
				country_event = { id = lar_portugal_purchase_ships.1 }
			}
			set_country_flag = POR_ships_purchase_in_progress_flag
			set_country_flag = {
  				flag = POR_ships_purchase_timer
    			days = 180
    			value = 1
			}
		}
	}

	POR_buy_ships_italy = {

		icon = eng_trade_unions_support

		available = {
			ITA = {
				has_war = no
				has_opinion = {
					target = ROOT
					value > 0
				}
			}
		}

		cost = 0

		ai_will_do = {
			base = 10
			modifier = {
				factor = 5
				ITA = { has_government = ROOT }
			}
			modifier = {
				factor = 0
				has_country_flag = POR_ships_purchase_timer
			}
		}
		
		visible = {
			has_completed_focus = POR_second_navy_reequipment
			ITA = {
				exists = yes
				NOT = { has_war_with = ROOT }
				has_civil_war = no
				has_capitulated = no
				owns_state = 2 #Owns Rome
			}
			NOT = { has_country_flag = POR_ships_purchase_in_progress_flag }
			NOT = { has_country_flag = POR_british_ships_purchase_rejected_flag }
		}
		complete_effect = {
			ITA = {
				country_event = { id = lar_portugal_purchase_ships.1 }
			}
			set_country_flag = POR_ships_purchase_in_progress_flag
			set_country_flag = {
  				flag = POR_ships_purchase_timer
    			days = 180
    			value = 1
			}
		}
	}

	#Mission to track the progress of British SUBMARINES construction
	POR_british_submarines_construction_progress = {
		
		icon = generic_naval

		allowed = {
			original_tag = POR
		}

		visible = {
			has_country_flag = POR_purchase_british_submarines_flag
		}

		modifier = {
			civilian_factory_use = 1
		}

		days_remove = 365

		cancel_trigger = {
			OR = {
				NOT = { country_exists = POR }
				NOT = { country_exists = ENG }
				ENG = {
					OR = {
						has_war_with = ROOT
						has_civil_war = yes
						has_capitulated = yes
						NOT = { owns_state = 126 } #Owns London
					}
				}
			}
		}

		#On Activation
		complete_effect ={
			ENG = {
				add_offsite_building = {
					type = industrial_complex
					level = 1
				}
			}
		}

		#Fail
		cancel_effect = {
			ENG = {
				add_offsite_building = {
					type = industrial_complex
					level = -1
				}
				remove_opinion_modifier = {
					target = POR
					modifier = POR_bought_ships
				}
			}
			remove_opinion_modifier = {
				target = ENG
				modifier = POR_sold_ships
			}
			remove_opinion_modifier = {
				target = ENG
				modifier = POR_ships_trade
			}			
			clr_country_flag = POR_purchase_british_submarines_flag
			clr_country_flag = POR_ships_purchase_in_progress_flag
		}

		#Success
		remove_effect = {
			if = { #1944
				limit = {
					ENG = {
						has_tech = improved_submarine_snorkel
						has_tech = improved_centimetric_radar
						has_tech = modern_range_engines
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = POR_1944_ENG_submarine_purchased_flag }
					}
					set_country_flag = POR_1944_ENG_submarine_purchased_flag
					ENG = {
						create_equipment_variant = {
							name = "Tubarão Class"
							type = ship_hull_submarine_1
							name_group = ENG_SS_HISTORICAL
							parent_version = 0
							allow_without_tech = yes
							role_icon_index = 6
							modules = {
								fixed_front_1 = ship_torpedo_sub_2
								fixed_deck = ship_sub_snorkel_2
								fixed_radar = ship_surveillance_radar_4
								fixed_engine = sub_ship_engine_4
								rear_1 = ship_torpedo_sub_2
								front_2 = ship_torpedo_sub_2
							}
							upgrades = {
								sub_engine_upgrade = 1
								sub_depth_upgrade = 3
							}
						}
					}
				}
				hidden_effect = { add_manpower = 270 } # 3 x 90MP/SS
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Tubarão Class" creator = ENG name = "NRP Tubarão" }
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Tubarão Class" creator = ENG name = "NRP Morsa" }
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Tubarão Class" creator = ENG name = "NRP Focenídeos" }
			}
			else_if = { #1942
				limit = {
					ENG = {
						has_tech = basic_submarine_snorkel
						has_tech = centimetric_radar
						has_tech = advanced_range_engines
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = POR_1942_ENG_submarine_purchased_flag }
					}
					set_country_flag = POR_1942_ENG_submarine_purchased_flag
					ENG = {
						create_equipment_variant = {
							name = "Perca Class"
							type = ship_hull_submarine_1
							name_group = ENG_SS_HISTORICAL
							parent_version = 0
							allow_without_tech = yes
							role_icon_index = 6
							modules = {
								fixed_front_1 = ship_torpedo_sub_2
								fixed_deck = ship_sub_snorkel_1
								fixed_radar = ship_surveillance_radar_3
								fixed_engine = sub_ship_engine_3
								rear_1 = ship_torpedo_sub_2
								front_2 = ship_torpedo_sub_2
							}
							upgrades = {
								sub_engine_upgrade = 1
								sub_depth_upgrade = 3
							}
						}
					}
				}
				hidden_effect = { add_manpower = 270 } # 3 x 90MP/SS
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Perca Class" creator = ENG name = "NRP Perca" }
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Perca Class" creator = ENG name = "NRP Sernambiguara" }
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Perca Class" creator = ENG name = "NRP Escamudo" }
			}
			else_if = { #1940
				limit = {
					ENG = {
						has_tech = basic_submarine_snorkel
						has_tech = decimetric_radar
						has_tech = advanced_range_engines
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = POR_1940_ENG_submarine_purchased_flag }
					}
					set_country_flag = POR_1940_ENG_submarine_purchased_flag
					ENG = {
						create_equipment_variant = {
							name = "Salmão Class"
							type = ship_hull_submarine_1
							name_group = ENG_SS_HISTORICAL
							parent_version = 0
							allow_without_tech = yes
							role_icon_index = 6
							modules = {
								fixed_front_1 = ship_torpedo_sub_2
								fixed_deck = ship_sub_snorkel_1
								fixed_radar = ship_surveillance_radar_2
								fixed_engine = sub_ship_engine_3
								rear_1 = ship_torpedo_sub_2
								front_2 = ship_torpedo_sub_2
							}
							upgrades = {
								sub_engine_upgrade = 1
								sub_depth_upgrade = 3
							}
						}
					}
				}
				hidden_effect = { add_manpower = 270 } # 3 x 90MP/SS
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Salmão Class" creator = ENG name = "NRP Salmão" }
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Salmão Class" creator = ENG name = "NRP Bonito" }
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Salmão Class" creator = ENG name = "NRP Caranha" }
			}
			else_if = { #1938
				limit = {
					ENG = {
						has_tech = decimetric_radar
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = POR_1938_ENG_submarine_purchased_flag }
					}
					set_country_flag = POR_1938_ENG_submarine_purchased_flag
					ENG = {
						create_equipment_variant = {
							name = "Esturjão Class"
							type = ship_hull_submarine_1
							name_group = ENG_SS_HISTORICAL
							parent_version = 0
							allow_without_tech = yes
							role_icon_index = 6
							modules = {
								fixed_front_1 = ship_torpedo_sub_2
								fixed_radar = ship_surveillance_radar_2
								fixed_engine = sub_ship_engine_2
								rear_1 = ship_torpedo_sub_2
								front_2 = ship_torpedo_sub_2
							}
							upgrades = {
								sub_engine_upgrade = 1
								sub_depth_upgrade = 3
							}
						}
					}
				}
				hidden_effect = { add_manpower = 270 } # 3 x 90MP/SS
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Esturjão Class" creator = ENG name = "NRP Esturjão" }
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Esturjão Class" creator = ENG name = "NRP Sargo" }
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Esturjão Class" creator = ENG name = "NRP Dragão-marinho" }
			}
			else = { #Fallback
				if = {
					limit = {
						NOT = { has_country_flag = POR_1936_ENG_submarine_purchased_flag }
					}
					set_country_flag = POR_1936_ENG_submarine_purchased_flag
					ENG = {
						create_equipment_variant = {
							name = "Tautog Class"
							type = ship_hull_submarine_1
							name_group = ENG_SS_HISTORICAL
							parent_version = 0
							role_icon_index = 6
							modules = {
								fixed_front_1 = ship_torpedo_sub_2
								fixed_radar = ship_surveillance_radar_1
								fixed_engine = sub_ship_engine_2
								rear_1 = ship_torpedo_sub_2
								front_2 = ship_torpedo_sub_2
							}
							upgrades = {
								sub_engine_upgrade = 1
								sub_depth_upgrade = 3
							}
						}
					}
				}
				hidden_effect = { add_manpower = 270 } # 3 x 90MP/SS
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Tautog Class" creator = ENG name = "NRP Tautog" }
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Tautog Class" creator = ENG name = "NRP Truta" }
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Tautog Class" creator = ENG name = "NRP Atum" }
			}

			ENG = {
				add_offsite_building = {
					type = industrial_complex
					level = -1
				}
			}
			country_event = lar_portugal_purchase_ships.4
			set_country_flag = POR_ships_purchased_flag
			clr_country_flag = POR_purchase_british_submarines_flag
			clr_country_flag = POR_ships_purchase_in_progress_flag
		}
	}

	#Mission to track the progress of Italian SUBMARINES construction
	POR_italian_submarines_construction_progress = {
		
		icon = generic_naval

		allowed = {
			original_tag = POR
		}

		visible = {
			has_country_flag = POR_purchase_italian_submarines_flag
		}

		modifier = {
			civilian_factory_use = 1
		}

		days_remove = 365

		cancel_trigger = {
			OR = {
				NOT = { country_exists = POR }
				NOT = { country_exists = ITA }
				ITA = {
					OR = {
						has_war_with = ROOT
						has_civil_war = yes
						has_capitulated = yes
						NOT = { owns_state = 2 } #Owns Rome
					}
				}
			}	
		}


		#On Activation
		complete_effect = {
			ITA = {
				add_offsite_building = {
					type = industrial_complex
					level = 1
				}
			}
		}

		#Fail
		cancel_effect = {
			ITA = {
				add_offsite_building = {
					type = industrial_complex
					level = -1
				}
				remove_opinion_modifier = {
					target = POR
					modifier = POR_bought_ships
				}
			}
			remove_opinion_modifier = {
				target = ITA
				modifier = POR_sold_ships
			}
			remove_opinion_modifier = {
				target = ITA
				modifier = POR_ships_trade
			}			
			clr_country_flag = POR_purchase_italian_submarines_flag
			clr_country_flag = POR_ships_purchase_in_progress_flag
		}

		#Success
		remove_effect = {
			if = { #1944
				limit = {
					ITA = {
						has_tech = improved_submarine_snorkel
						has_tech = improved_centimetric_radar
						has_tech = modern_range_engines
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = POR_1944_ITA_submarine_purchased_flag }
					}
					set_country_flag = POR_1944_ITA_submarine_purchased_flag
					ITA = {
						create_equipment_variant = {
							name = "Cavalinha Class"
							type = ship_hull_submarine_1
							name_group = ITA_SS_HISTORICAL
							parent_version = 0
							allow_without_tech = yes
							role_icon_index = 6
							modules = {
								fixed_front_1 = ship_torpedo_sub_2
								fixed_deck = ship_sub_snorkel_2
								fixed_radar = ship_surveillance_radar_4
								fixed_engine = sub_ship_engine_4
								rear_1 = ship_torpedo_sub_2
								rear_2 = ship_torpedo_sub_2
							}
							upgrades = {
								sub_engine_upgrade = 4
								sub_depth_upgrade = 7
							}
						}
					}
				}
				hidden_effect = { add_manpower = 270 } # 3 x 90MP/SS
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Cavalinha Class" creator = ITA name = "NRP Cavalinha" }
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Cavalinha Class" creator = ITA name = "NRP Marlim" }
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Cavalinha Class" creator = ITA name = "NRP Leão-marinho" }
			}
			else_if = { #1942
				limit = {
					ITA = {
						has_tech = basic_submarine_snorkel
						has_tech = centimetric_radar
						has_tech = advanced_range_engines
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = POR_1942_ITA_submarine_purchased_flag }
					}
					set_country_flag = POR_1942_ITA_submarine_purchased_flag
					ITA = {
						create_equipment_variant = {
							name = "Garoupa Class"
							type = ship_hull_submarine_1
							name_group = ITA_SS_HISTORICAL
							parent_version = 0
							allow_without_tech = yes
							role_icon_index = 6
							modules = {
								fixed_front_1 = ship_torpedo_sub_2
								fixed_deck = ship_sub_snorkel_1
								fixed_radar = ship_surveillance_radar_3
								fixed_engine = sub_ship_engine_3
								rear_1 = ship_torpedo_sub_2
								rear_2 = ship_torpedo_sub_2
							}
							upgrades = {
								sub_engine_upgrade = 4
								sub_depth_upgrade = 7
							}
						}
					}
				}
				hidden_effect = { add_manpower = 270 } # 3 x 90MP/SS
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Garoupa Class" creator = ITA name = "NRP Garoupa" }
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Garoupa Class" creator = ITA name = "NRP Exocetídeos" }
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Garoupa Class" creator = ITA name = "NRP Cienídeos" }
			}
			else_if = { #1940
				limit = {
					ITA = {
						has_tech = basic_submarine_snorkel
						has_tech = decimetric_radar
						has_tech = advanced_range_engines
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = POR_1940_ITA_submarine_purchased_flag }
					}
					set_country_flag = POR_1940_ITA_submarine_purchased_flag
					ITA = {
						create_equipment_variant = {
							name = "Eglefim Class"
							type = ship_hull_submarine_1
							name_group = ITA_SS_HISTORICAL
							parent_version = 0
							allow_without_tech = yes
							role_icon_index = 6
							modules = {
								fixed_front_1 = ship_torpedo_sub_2
								fixed_deck = ship_sub_snorkel_1
								fixed_radar = ship_surveillance_radar_2
								fixed_engine = sub_ship_engine_3
								rear_1 = ship_torpedo_sub_2
								rear_2 = ship_torpedo_sub_2
							}
							upgrades = {
								sub_engine_upgrade = 4
								sub_depth_upgrade = 7
							}
						}
					}
				}
				hidden_effect = { add_manpower = 270 } # 3 x 90MP/SS
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Eglefim Class" creator = ITA name = "NRP Eglefim" }
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Eglefim Class" creator = ITA name = "NRP Halibute" }
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Eglefim Class" creator = ITA name = "NRP Papa-terra" }
			}
			else_if = { #1938
				limit = {
					ITA = {
						has_tech = decimetric_radar
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = POR_1938_ITA_submarine_purchased_flag }
					}
					set_country_flag = POR_1938_ITA_submarine_purchased_flag
					ITA = {
						create_equipment_variant = {
							name = "Misticetos Class"
							type = ship_hull_submarine_1
							name_group = ITA_SS_HISTORICAL
							parent_version = 0
							allow_without_tech = yes
							role_icon_index = 6
							modules = {
								fixed_front_1 = ship_torpedo_sub_2
								fixed_radar = ship_surveillance_radar_2
								fixed_engine = sub_ship_engine_2
								rear_1 = ship_torpedo_sub_2
								rear_2 = ship_torpedo_sub_2
							}
							upgrades = {
								sub_engine_upgrade = 4
								sub_depth_upgrade = 7
							}
						}
					}
				}
				hidden_effect = { add_manpower = 270 } # 3 x 90MP/SS
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Misticetos Class" creator = ITA name = "NRP Misticetos" }
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Misticetos Class" creator = ITA name = "NRP Sarda" }
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Misticetos Class" creator = ITA name = "NRP Cavalla" }
			}
			else_if = { #1936
				limit = {
					ITA = {
						has_tech = radio_detection
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = POR_1936_ITA_submarine_purchased_flag }
					}
					set_country_flag = POR_1936_ITA_submarine_purchased_flag
					ITA = {
						create_equipment_variant = {
							name = "Lúcio Class"
							type = ship_hull_submarine_1
							name_group = ITA_SS_HISTORICAL
							parent_version = 0
							allow_without_tech = yes
							role_icon_index = 6
							modules = {
								fixed_front_1 = ship_torpedo_sub_2
								fixed_radar = ship_surveillance_radar_1
								fixed_engine = sub_ship_engine_2
								rear_1 = ship_torpedo_sub_2
								rear_2 = ship_torpedo_sub_2
							}
							upgrades = {
								sub_engine_upgrade = 4
								sub_depth_upgrade = 7
							}
						}
					}
				}
				hidden_effect = { add_manpower = 270 } # 3 x 90MP/SS
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Lúcio Class" creator = ITA name = "NRP Lúcio" }
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Lúcio Class" creator = ITA name = "NRP Choco" }
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Lúcio Class" creator = ITA name = "NRP Barracuda" }
			}
			else = { #Fallback
				if = {
					limit = {
						NOT = { has_country_flag = POR_1934_ITA_submarine_purchased_flag }
					}
					set_country_flag = POR_1934_ITA_submarine_purchased_flag
					ITA = {
						create_equipment_variant = {
							name = "Robalo Class"
							type = ship_hull_submarine_1
							name_group = ITA_SS_HISTORICAL
							parent_version = 0
							role_icon_index = 6
							modules = {
								fixed_front_1 = ship_torpedo_sub_2
								fixed_engine = sub_ship_engine_2
								rear_1 = ship_torpedo_sub_2
								rear_2 = ship_torpedo_sub_2
							}
							upgrades = {
								sub_engine_upgrade = 4
								sub_depth_upgrade = 7
							}
						}
					}
				}
				hidden_effect = { add_manpower = 240 } # 3 x 80MP/SS
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Robalo Class" creator = ITA name = "NRP Robalo" }
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Robalo Class" creator = ITA name = "NRP Cisco" }
				create_ship = { type = ship_hull_submarine_1 equipment_variant = "Robalo Class" creator = ITA name = "NRP Peixe-lua" }
			}

			ITA = {
				add_offsite_building = {
					type = industrial_complex
					level = -1
				}
			}
			country_event = lar_portugal_purchase_ships.4
			set_country_flag = POR_ships_purchased_flag
			clr_country_flag = POR_purchase_italian_submarines_flag
			clr_country_flag = POR_ships_purchase_in_progress_flag
		}
	}

	#Mission to track the progress of British DESTROYERS construction
	POR_british_destroyers_construction_progress = {
		
		icon = generic_naval

		allowed = {
			original_tag = POR
		}

		visible = {
			has_country_flag = POR_purchase_british_destroyers_flag
		}
		
		modifier = {
			civilian_factory_use = 1
		}

		days_remove = 365

		cancel_trigger = {
			OR = {
				NOT = { country_exists = POR }
				NOT = { country_exists = ENG }
				ENG = {
					OR = {
						has_war_with = ROOT
						has_civil_war = yes
						has_capitulated = yes
						NOT = { owns_state = 126 } #Owns London
					}
				}
			}
		}

		#On Activation
		complete_effect = {
			ENG = {
				add_offsite_building = {
					type = industrial_complex
					level = 1
				}
			}
		}

		#Fail
		cancel_effect = {
			ENG = {
				add_offsite_building = {
					type = industrial_complex
					level = -1
				}
				remove_opinion_modifier = {
					target = POR
					modifier = POR_bought_ships
				}
			}
			remove_opinion_modifier = {
				target = ENG
				modifier = POR_sold_ships
			}
			remove_opinion_modifier = {
				target = ENG
				modifier = POR_ships_trade
			}		
			clr_country_flag = POR_purchase_british_destroyers_flag
			clr_country_flag = POR_ships_purchase_in_progress_flag
		}

		#Success
		remove_effect = {
			if = { #1944
				limit = {
					ENG = {
						has_tech = advanced_light_battery
						has_tech = advanced_sonar
						has_tech = improved_centimetric_radar
						has_tech = modern_range_engines
						has_tech = modern_depth_charges
						has_tech = antiair5
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = POR_1944_ENG_destroyer_purchased_flag }
					}
					set_country_flag = POR_1944_ENG_destroyer_purchased_flag
					ENG = {
						create_equipment_variant = {
							name = "Oeiras Class"
							type = ship_hull_light_1
							name_group = ENG_DD_HISTORICAL
							parent_version = 0
							allow_without_tech = yes
							role_icon_index = 1
							modules = {
								fixed_front_1 = ship_light_battery_4
								fixed_target_acquisition = ship_sonar_4
								fixed_radar = ship_surveillance_radar_4
								fixed_engine = ship_range_engine_4
								rear_1 = ship_depth_charge_4
								rear_2 = ship_anti_air_4
								mid_1 = ship_torpedo_2
								mid_2 = ship_torpedo_2
								front_2 = ship_anti_air_4
							}
							upgrades = {
								ship_light_engine_upgrade = 8
							}
						}
					}
				}
				hidden_effect = { add_manpower = 460 } # 2 x 230MP/DD
				create_ship = { type = ship_hull_light_1 equipment_variant = "Oeiras Class" creator = ENG name = "NRP Oeiras" }
				create_ship = { type = ship_hull_light_1 equipment_variant = "Oeiras Class" creator = ENG name = "NRP Gondomar" }
			}
			else_if = { #1942
				limit = {
					ENG = {
						has_tech = improved_sonar
						has_tech = centimetric_radar
						has_tech = advanced_range_engines
						has_tech = advanced_depth_charges
						has_tech = antiair2
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = POR_1942_ENG_destroyer_purchased_flag }
					}
					set_country_flag = POR_1942_ENG_destroyer_purchased_flag
					ENG = {
						create_equipment_variant = {
							name = "Guimarães Class"
							type = ship_hull_light_1
							name_group = ENG_DD_HISTORICAL
							parent_version = 0
							allow_without_tech = yes
							role_icon_index = 1
							modules = {
								fixed_front_1 = ship_light_battery_3
								fixed_target_acquisition = ship_sonar_3
								fixed_radar = ship_surveillance_radar_3
								fixed_engine = ship_range_engine_3
								rear_1 = ship_depth_charge_3
								rear_2 = ship_anti_air_3
								mid_1 = ship_torpedo_2
								mid_2 = ship_torpedo_2
								front_2 = ship_anti_air_3
							}
							upgrades = {
								ship_light_engine_upgrade = 8
							}
						}
					}
				}
				hidden_effect = { add_manpower = 460 } # 2 x 230MP/DD
				create_ship = { type = ship_hull_light_1 equipment_variant = "Guimarães Class" creator = ENG name = "NRP Guimarães" }
				create_ship = { type = ship_hull_light_1 equipment_variant = "Guimarães Class" creator = ENG name = "NRP Santa Maria Da Feira" }
			}
			else_if = { #1940
				limit = {
					ENG = {
						has_tech = improved_sonar
						has_tech = decimetric_radar
						has_tech = advanced_range_engines
						has_tech = advanced_depth_charges
						has_tech = antiair2
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = POR_1940_ENG_destroyer_purchased_flag }
					}
					set_country_flag = POR_1940_ENG_destroyer_purchased_flag
					ENG = {
						create_equipment_variant = {
							name = "Maia Class"
							type = ship_hull_light_1
							name_group = ENG_DD_HISTORICAL
							parent_version = 0
							allow_without_tech = yes
							role_icon_index = 1
							modules = {
								fixed_front_1 = ship_light_battery_3
								fixed_target_acquisition = ship_sonar_3
								fixed_radar = ship_surveillance_radar_2
								fixed_engine = ship_range_engine_3
								rear_1 = ship_depth_charge_3
								rear_2 = ship_anti_air_3
								mid_1 = ship_torpedo_2
								mid_2 = ship_torpedo_2
								front_2 = ship_anti_air_3
							}
							upgrades = {
								ship_light_engine_upgrade = 8
							}
						}
					}
				}
				hidden_effect = { add_manpower = 460 } # 2 x 230MP/DD
				create_ship = { type = ship_hull_light_1 equipment_variant = "Maia Class" creator = ENG name = "NRP Maia" }
				create_ship = { type = ship_hull_light_1 equipment_variant = "Maia Class" creator = ENG name = "NRP Famalicão" }
			}
			else_if = { #1938
				limit = {
					ENG = {
						has_tech = decimetric_radar
						has_tech = improved_depth_charges
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = POR_1938_ENG_destroyer_purchased_flag }
					}
					set_country_flag = POR_1938_ENG_destroyer_purchased_flag
					ENG = {
						create_equipment_variant = {
							name = "Setúbal Class"
							type = ship_hull_light_1
							name_group = ENG_DD_HISTORICAL
							parent_version = 0
							allow_without_tech = yes
							role_icon_index = 1
							modules = {
								fixed_front_1 = ship_light_battery_3
								fixed_target_acquisition = ship_sonar_2
								fixed_radar = ship_surveillance_radar_2
								fixed_engine = ship_range_engine_2
								rear_1 = ship_depth_charge_2
								rear_2 = ship_anti_air_2
								mid_1 = ship_torpedo_2
								mid_2 = ship_torpedo_2
								front_2 = ship_anti_air_2
							}
							upgrades = {
								ship_light_engine_upgrade = 8
							}
						}
					}
				}
				hidden_effect = { add_manpower = 460 } # 2 x 230MP/DD
				create_ship = { type = ship_hull_light_1 equipment_variant = "Setúbal Class" creator = ENG name = "NRP Setúbal" }
				create_ship = { type = ship_hull_light_1 equipment_variant = "Setúbal Class" creator = ENG name = "NRP Valongo" }
			}
			else_if = { #1936
				limit = {
					ENG = {
						has_tech = improved_depth_charges
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = POR_1936_ENG_destroyer_purchased_flag }
					}
					set_country_flag = POR_1936_ENG_destroyer_purchased_flag
					ENG = {
						create_equipment_variant = {
							name = "Paredes Class"
							type = ship_hull_light_1
							name_group = ENG_DD_HISTORICAL
							parent_version = 0
							allow_without_tech = yes
							role_icon_index = 1
							modules = {
								fixed_front_1 = ship_light_battery_3
								fixed_target_acquisition = ship_sonar_2
								fixed_radar = ship_surveillance_radar_1
								fixed_engine = ship_range_engine_2
								rear_1 = ship_depth_charge_2
								rear_2 = ship_anti_air_2
								mid_1 = ship_torpedo_2
								mid_2 = ship_torpedo_2
								front_2 = ship_anti_air_2
							}
							upgrades = {
								ship_light_engine_upgrade = 8
							}
						}
					}
				}
				hidden_effect = { add_manpower = 460 } # 2 x 230MP/DD
				create_ship = { type = ship_hull_light_1 equipment_variant = "Paredes Class" creator = ENG name = "NRP Paredes" }
				create_ship = { type = ship_hull_light_1 equipment_variant = "Paredes Class" creator = ENG name = "NRP Aveiro" }
			}
			else = { #Fallback
				if = {
					limit = {
						NOT = { has_country_flag = POR_1934_ENG_destroyer_purchased_flag }
					}
					set_country_flag = POR_1934_ENG_destroyer_purchased_flag
					ENG = {
						create_equipment_variant = {
							name = "Viseu Class"
							type = ship_hull_light_1
							name_group = ENG_DD_HISTORICAL
							parent_version = 0
							role_icon_index = 1
							modules = {
								fixed_front_1 = ship_light_battery_2
								fixed_target_acquisition = ship_sonar_2
								fixed_radar = ship_surveillance_radar_1
								fixed_engine = ship_range_engine_2
								rear_1 = ship_depth_charge_1
								rear_2 = ship_anti_air_2
								mid_1 = ship_torpedo_2
								mid_2 = ship_torpedo_2
								front_2 = ship_anti_air_2
							}
							upgrades = {
								ship_light_engine_upgrade = 8
							}
						}
					}
				}
				hidden_effect = { add_manpower = 460 } # 2 x 230MP/DD
				create_ship = { type = ship_hull_light_1 equipment_variant = "Viseu Class" creator = ENG name = "NRP Viseu" }
				create_ship = { type = ship_hull_light_1 equipment_variant = "Viseu Class" creator = ENG name = "NRP Portimão" }
			}

			ENG = {
				add_offsite_building = {
					type = industrial_complex
					level = -1
				}
			}
			country_event = lar_portugal_purchase_ships.5
			set_country_flag = POR_ships_purchased_flag
			clr_country_flag = POR_purchase_british_destroyers_flag
			clr_country_flag = POR_ships_purchase_in_progress_flag
		}
	}

	#Mission to track the progress of Italian DESTROYERS construction
	POR_italian_destroyers_construction_progress = {
		
		icon = generic_naval

		allowed = {
			original_tag = POR
		}

		visible = {
			has_country_flag = POR_purchase_italian_destroyers_flag
		}

		modifier = {
			civilian_factory_use = 1
		}

		days_remove = 365

		cancel_trigger = {
			OR = {
				NOT = { country_exists = POR }
				NOT = { country_exists = ITA }
				ITA = {
					OR = {
						has_war_with = ROOT
						has_civil_war = yes
						has_capitulated = yes
						NOT = { owns_state = 2 } #Owns Rome
					}
				}
			}
		}

		#On Activation
		complete_effect ={
			ITA = {
				add_offsite_building = {
					type = industrial_complex
					level = 1
				}
			}
		}

		#Fail
		cancel_effect = {
			ITA = {
				add_offsite_building = {
					type = industrial_complex
					level = -1
				}
				remove_opinion_modifier = {
					target = POR
					modifier = POR_bought_ships
				}
			}
			remove_opinion_modifier = {
				target = ITA
				modifier = POR_sold_ships
			}
			remove_opinion_modifier = {
				target = ITA
				modifier = POR_ships_trade
			}		
			clr_country_flag = POR_purchase_italian_destroyers_flag
			clr_country_flag = POR_ships_purchase_in_progress_flag
		}

		is_good = yes
		#Success
		remove_effect = {
			if = { #1944
				limit = {
					ITA = {
						has_tech = advanced_light_battery
						has_tech = advanced_sonar
						has_tech = improved_centimetric_radar
						has_tech = modern_range_engines
						has_tech = modern_depth_charges
						has_tech = antiair5
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = POR_1944_ITA_destroyer_purchased_flag }
					}
					set_country_flag = POR_1944_ITA_destroyer_purchased_flag
					ITA = {
						create_equipment_variant = {
							name = "Almada Class"
							type = ship_hull_light_1
							name_group = ITA_DD_HISTORICAL
							parent_version = 0
							allow_without_tech = yes
							role_icon_index = 1
							modules = {
								fixed_front_1 = ship_light_battery_4
								fixed_target_acquisition = ship_sonar_4
								fixed_radar = ship_surveillance_radar_4
								fixed_engine = ship_range_engine_4
								rear_1 = ship_depth_charge_4
								rear_2 = ship_light_battery_4
								mid_1 = ship_torpedo_2
								mid_2 = ship_anti_air_4
								front_2 = ship_light_battery_4
							}
							upgrades = {
								ship_light_engine_upgrade = 9
							}
						}
					}
				}
				hidden_effect = { add_manpower = 560 } # 2 x 280MP/DD
				create_ship = { type = ship_hull_light_1 equipment_variant = "Almada Class" creator = ITA name = "NRP Almada" }
				create_ship = { type = ship_hull_light_1 equipment_variant = "Almada Class" creator = ITA name = "NRP Seixal" }
			}
			else_if = { #1942
				limit = {
					ITA = {
						has_tech = improved_light_battery
						has_tech = improved_sonar
						has_tech = centimetric_radar
						has_tech = advanced_range_engines
						has_tech = advanced_depth_charges
						has_tech = antiair2
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = POR_1942_ITA_destroyer_purchased_flag }
					}
					set_country_flag = POR_1942_ITA_destroyer_purchased_flag
					ITA = {
						create_equipment_variant = {
							name = "Odivelas Class"
							type = ship_hull_light_1
							name_group = ITA_DD_HISTORICAL
							parent_version = 0
							allow_without_tech = yes
							role_icon_index = 1
							modules = {
								fixed_front_1 = ship_light_battery_3
								fixed_target_acquisition = ship_sonar_3
								fixed_radar = ship_surveillance_radar_3
								fixed_engine = ship_range_engine_3
								rear_1 = ship_depth_charge_3
								rear_2 = ship_light_battery_3
								mid_1 = ship_torpedo_2
								mid_2 = ship_anti_air_3
								front_2 = ship_light_battery_3
							}
							upgrades = {
								ship_light_engine_upgrade = 9
							}
						}
					}
				}
				hidden_effect = { add_manpower = 560 } # 2 x 280MP/DD
				create_ship = { type = ship_hull_light_1 equipment_variant = "Odivelas Class" creator = ITA name = "NRP Odivelas" }
				create_ship = { type = ship_hull_light_1 equipment_variant = "Odivelas Class" creator = ITA name = "NRP Vila Franca De Xira" }
			}
			else_if = { #1940
				limit = {
					ITA = {
						has_tech = improved_light_battery
						has_tech = improved_sonar
						has_tech = decimetric_radar
						has_tech = advanced_range_engines
						has_tech = advanced_depth_charges
						has_tech = antiair2
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = POR_1940_ITA_destroyer_purchased_flag }
					}
					set_country_flag = POR_1940_ITA_destroyer_purchased_flag
					ITA = {
						create_equipment_variant = {
							name = "Coimbra Class"
							type = ship_hull_light_1
							name_group = ITA_DD_HISTORICAL
							parent_version = 0
							allow_without_tech = yes
							role_icon_index = 1
							modules = {
								fixed_front_1 = ship_light_battery_3
								fixed_target_acquisition = ship_sonar_3
								fixed_radar = ship_surveillance_radar_2
								fixed_engine = ship_range_engine_3
								rear_1 = ship_depth_charge_3
								rear_2 = ship_light_battery_3
								mid_1 = ship_torpedo_2
								mid_2 = ship_anti_air_3
								front_2 = ship_light_battery_3
							}
							upgrades = {
								ship_light_engine_upgrade = 9
							}
						}
					}
				}
				hidden_effect = { add_manpower = 560 } # 2 x 280MP/DD
				create_ship = { type = ship_hull_light_1 equipment_variant = "Coimbra Class" creator = ITA name = "NRP Coimbra" }
				create_ship = { type = ship_hull_light_1 equipment_variant = "Coimbra Class" creator = ITA name = "NRP Leiria" }
			}
			else_if = { #1938
				limit = {
					ITA = {
						has_tech = basic_sonar
						has_tech = decimetric_radar
						has_tech = improved_depth_charges
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = POR_1938_ITA_destroyer_purchased_flag }
					}
					set_country_flag = POR_1938_ITA_destroyer_purchased_flag
					ITA = {
						create_equipment_variant = {
							name = "Funchal Class"
							type = ship_hull_light_1
							name_group = ITA_DD_HISTORICAL
							parent_version = 0
							allow_without_tech = yes
							role_icon_index = 1
							modules = {
								fixed_front_1 = ship_light_battery_2
								fixed_target_acquisition = ship_sonar_2
								fixed_radar = ship_surveillance_radar_2
								fixed_engine = ship_range_engine_2
								rear_1 = ship_depth_charge_2
								rear_2 = ship_light_battery_2
								mid_1 = ship_torpedo_2
								mid_2 = ship_anti_air_2
								front_2 = ship_light_battery_2
							}
							upgrades = {
								ship_light_engine_upgrade = 9
							}
						}
					}
				}
				hidden_effect = { add_manpower = 560 } # 2 x 280MP/DD
				create_ship = { type = ship_hull_light_1 equipment_variant = "Funchal Class" creator = ITA name = "NRP Funchal" }
				create_ship = { type = ship_hull_light_1 equipment_variant = "Funchal Class" creator = ITA name = "NRP Viana do Castelo" }
			}
			else_if = { #1936
				limit = {
					ITA = {
						has_tech = basic_sonar
						has_tech = radio_detection
						has_tech = improved_depth_charges
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = POR_1936_ITA_destroyer_purchased_flag }
					}
					set_country_flag = POR_1936_ITA_destroyer_purchased_flag
					ITA = {
						create_equipment_variant = {
							name = "Vila Do Conde Class"
							type = ship_hull_light_1
							name_group = ITA_DD_HISTORICAL
							parent_version = 0
							allow_without_tech = yes
							role_icon_index = 1
							modules = {
								fixed_front_1 = ship_light_battery_2
								fixed_target_acquisition = ship_sonar_2
								fixed_radar = ship_surveillance_radar_1
								fixed_engine = ship_range_engine_2
								rear_1 = ship_depth_charge_2
								rear_2 = ship_light_battery_2
								mid_1 = ship_torpedo_2
								mid_2 = ship_anti_air_2
								front_2 = ship_light_battery_2
							}
							upgrades = {
								ship_light_engine_upgrade = 9
							}
						}
					}
				}
				hidden_effect = { add_manpower = 560 } # 2 x 280MP/DD
				create_ship = { type = ship_hull_light_1 equipment_variant = "Vila Do Conde Class" creator = ITA name = "NRP Vila Do Conde" }
				create_ship = { type = ship_hull_light_1 equipment_variant = "Vila Do Conde Class" creator = ITA name = "NRP Mafra" }
			}
			else = { #Fallback
				if = {
					limit = {
						NOT = { has_country_flag = POR_1934_ITA_destroyer_purchased_flag }
					}
					set_country_flag = POR_1934_ITA_destroyer_purchased_flag
					ITA = {
						create_equipment_variant = {
							name = "Faro Class"
							type = ship_hull_light_1
							name_group = ITA_DD_HISTORICAL
							parent_version = 0
							role_icon_index = 1
							modules = {
								fixed_front_1 = ship_light_battery_2
								fixed_target_acquisition = ship_sonar_1
								fixed_engine = ship_range_engine_2
								rear_1 = ship_depth_charge_1
								rear_2 = ship_light_battery_2
								mid_1 = ship_torpedo_2
								mid_2 = ship_anti_air_2
								front_2 = ship_light_battery_2
							}
							upgrades = {
								ship_light_engine_upgrade = 9
							}
						}
					}
				}
				hidden_effect = { add_manpower = 540 } # 2 x 270MP/DD
				create_ship = { type = ship_hull_light_1 equipment_variant = "Faro Class" creator = ITA name = "NRP Faro" }
				create_ship = { type = ship_hull_light_1 equipment_variant = "Faro Class" creator = ITA name = "NRP Évora" }
			}

			ITA = {
				add_offsite_building = {
					type = industrial_complex
					level = -1
				}
			}
			country_event = lar_portugal_purchase_ships.5
			set_country_flag = POR_ships_purchased_flag
			clr_country_flag = POR_purchase_italian_destroyers_flag
			clr_country_flag = POR_ships_purchase_in_progress_flag
		}
	}

	#Mission to track the progress of British LIGHT CRUISER construction
	POR_british_light_cruiser_construction_progress = {
		
		icon = generic_naval

		allowed = {
			original_tag = POR
		}

		visible = {
			has_country_flag = POR_purchase_british_light_cruiser_flag
		}
		
		modifier = {
			civilian_factory_use = 1
		}

		days_remove = 365

		cancel_trigger = {
			OR = {
				NOT = { country_exists = POR }
				NOT = { country_exists = ENG }
				ENG = {
					OR = {
						has_war_with = ROOT
						has_civil_war = yes
						has_capitulated = yes
						NOT = { owns_state = 126 } #Owns London
					}
				}
			}
		}

		#Fail
		cancel_effect = {
			ENG = {
				add_offsite_building = {
					type = industrial_complex
					level = -1
				}
				remove_opinion_modifier = {
					target = POR
					modifier = POR_bought_ships
				}
			}
			remove_opinion_modifier = {
				target = ENG
				modifier = POR_sold_ships
			}
			remove_opinion_modifier = {
				target = ENG
				modifier = POR_ships_trade
			}
			clr_country_flag = POR_purchase_british_light_cruiser_flag
			clr_country_flag = POR_ships_purchase_in_progress_flag
		}

		#Success
		remove_effect = {
			if = { #1946
				limit = {
					ENG = {
						has_tech = advanced_light_medium_battery
						has_tech = advanced_fire_control_system
						has_tech = advanced_centimetric_radar
						has_tech = modern_range_engines
						has_tech = antiair5
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = POR_1946_ENG_cruiser_purchased_flag }
					}
					set_country_flag = POR_1946_ENG_cruiser_purchased_flag
					ENG = {
						create_equipment_variant = {
							name = "Lisboa Class"
							type = ship_hull_cruiser_1
							name_group = ENG_CL_HISTORICAL
							parent_version = 0
							allow_without_tech = yes
							role_icon_index = 1
							modules = {
								fixed_front_1 = ship_light_medium_battery_4
								fixed_target_acquisition = ship_fire_control_system_3
								fixed_radar = ship_fire_control_radar_2
								fixed_engine = ship_range_engine_4
								rear_1 = ship_light_medium_battery_4
								rear_2 = ship_anti_air_4
								mid_1 = ship_torpedo_2
								mid_2 = ship_torpedo_2
								front_2 = ship_anti_air_4
							}
							upgrades = {
								ship_medium_engine_upgrade = 9
								ship_medium_armor_upgrade = 2
							}
						}
					}
				}
				hidden_effect = { add_manpower = 1080 }
				create_ship = { type = ship_hull_cruiser_1 equipment_variant = "Lisboa Class" creator = ENG name = "NRP Lisboa" }
			}
			else_if = { #1944
				limit = {
					ENG = {
						has_tech = advanced_light_medium_battery
						has_tech = advanced_fire_control_system
						has_tech = improved_decimetric_radar
						has_tech = modern_range_engines
						has_tech = antiair5
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = POR_1944_ENG_cruiser_purchased_flag }
					}
					set_country_flag = POR_1944_ENG_cruiser_purchased_flag
					ENG = {
						create_equipment_variant = {
							name = "Vila Nova de Gaia Class"
							type = ship_hull_cruiser_1
							name_group = ENG_CL_HISTORICAL
							parent_version = 0
							allow_without_tech = yes
							role_icon_index = 1
							modules = {
								fixed_front_1 = ship_light_medium_battery_4
								fixed_target_acquisition = ship_fire_control_system_3
								fixed_radar = ship_fire_control_radar_1
								fixed_engine = ship_range_engine_4
								rear_1 = ship_light_medium_battery_4
								rear_2 = ship_anti_air_4
								mid_1 = ship_torpedo_2
								mid_2 = ship_torpedo_2
								front_2 = ship_anti_air_4
							}
							upgrades = {
								ship_medium_engine_upgrade = 9
								ship_medium_armor_upgrade = 2
							}
						}
					}
				}
				hidden_effect = { add_manpower = 1080 }
				create_ship = { type = ship_hull_cruiser_1 equipment_variant = "Vila Nova de Gaia Class" creator = ENG name = "NRP Vila Nova de Gaia" }
			}
			else_if = { #1940
				limit = {
					ENG = {
						has_tech = improved_light_medium_battery
						has_tech = improved_fire_control_system
						has_tech = improved_decimetric_radar
						has_tech = advanced_range_engines
						has_tech = antiair2
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = POR_1940_ENG_cruiser_purchased_flag }
					}
					set_country_flag = POR_1940_ENG_cruiser_purchased_flag
					ENG = {
						create_equipment_variant = {
							name = "Cascais Class"
							type = ship_hull_cruiser_1
							name_group = ENG_CL_HISTORICAL
							parent_version = 0
							allow_without_tech = yes
							role_icon_index = 1
							modules = {
								fixed_front_1 = ship_light_medium_battery_3
								fixed_target_acquisition = ship_fire_control_system_2
								fixed_radar = ship_fire_control_radar_1
								fixed_engine = ship_range_engine_3
								rear_1 = ship_light_medium_battery_3
								rear_2 = ship_anti_air_3
								mid_1 = ship_torpedo_2
								mid_2 = ship_torpedo_2
								front_2 = ship_anti_air_3
							}
							upgrades = {
								ship_medium_engine_upgrade = 8
								ship_medium_armor_upgrade = 2
							}
						}
					}
				}
				hidden_effect = { add_manpower = 1080 }
				create_ship = { type = ship_hull_cruiser_1 equipment_variant = "Cascais Class" creator = ENG name = "NRP Cascais" }
			}
			else = { #Fallback
				if = {
					limit = {
						NOT = { has_country_flag = POR_1934_ENG_cruiser_purchased_flag }
					}
					set_country_flag = POR_1934_ENG_cruiser_purchased_flag
					ENG = {
						create_equipment_variant = {
							name = "Braga Class"
							type = ship_hull_cruiser_1
							name_group = ENG_CL_HISTORICAL
							parent_version = 0
							role_icon_index = 1
							modules = {
								fixed_front_1 = ship_light_medium_battery_2
								fixed_target_acquisition = ship_fire_control_system_1
								fixed_engine = ship_range_engine_2
								rear_1 = ship_light_medium_battery_2
								rear_2 = ship_anti_air_2
								mid_1 = ship_torpedo_2
								mid_2 = ship_torpedo_2
								front_2 = ship_anti_air_2
							}
							upgrades = {
								ship_medium_engine_upgrade = 7
								ship_medium_armor_upgrade = 2
							}
						}
					}
				}
				hidden_effect = { add_manpower = 1070 }
				create_ship = { type = ship_hull_cruiser_1 equipment_variant = "Matosinhos Class" creator = ENG name = "NRP Matosinhos" }
			}

			ENG = {
				add_offsite_building = {
					type = industrial_complex
					level = -1
				}
			}
			country_event = lar_portugal_purchase_ships.6
			set_country_flag = POR_ships_purchased_flag
			clr_country_flag = POR_purchase_british_light_cruiser_flag
			clr_country_flag = POR_ships_purchase_in_progress_flag
		}
	}

	#Mission to track the progress of Italian LIGHT CRUISER construction
	POR_italian_light_cruiser_construction_progress = {
		
		icon = generic_naval

		allowed = {
			original_tag = POR
		}

		visible = {
			has_country_flag = POR_purchase_italian_light_cruiser_flag
		}
		
		modifier = {
			civilian_factory_use = 1
		}

		days_remove = 546

		cancel_trigger = {
			OR = {
				NOT = { country_exists = POR }
				NOT = { country_exists = ITA }
				ITA = {
					OR = {
						has_war_with = ROOT
						has_civil_war = yes
						has_capitulated = yes
						NOT = { owns_state = 2 } #Owns Rome
					}
				}
			}
		}

		#On Activation
		complete_effect ={
			ITA = {
				add_offsite_building = {
					type = industrial_complex
					level = 1
				}
			}
		}

		#Fail
		cancel_effect = {
			ITA = {
				add_offsite_building = {
					type = industrial_complex
					level = -1
				}
				remove_opinion_modifier = {
					target = POR
					modifier = POR_bought_ships
				}
			}
			remove_opinion_modifier = {
				target = ITA
				modifier = POR_sold_ships
			}
			remove_opinion_modifier = {
				target = ITA
				modifier = POR_ships_trade
			}
			clr_country_flag = POR_purchase_italian_light_cruiser_flag
			clr_country_flag = POR_ships_purchase_in_progress_flag
		}

		#Success
		remove_effect = {
			if = { #1946
				limit = {
					ITA = {
						has_tech = advanced_light_medium_battery
						has_tech = advanced_fire_control_system
						has_tech = advanced_centimetric_radar
						has_tech = modern_perf_engines
						has_tech = antiair5
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = POR_1946_ITA_cruiser_purchased_flag }
					}
					set_country_flag = POR_1946_ITA_cruiser_purchased_flag
					ITA = {
						create_equipment_variant = {
							name = "Sintra Class"
							type = ship_hull_cruiser_1
							name_group = ITA_CL_HISTORICAL
							parent_version = 0
							allow_without_tech = yes
							role_icon_index = 1
							modules = {
								fixed_front_1 = ship_light_medium_battery_4
								fixed_target_acquisition = ship_fire_control_system_3
								fixed_radar = ship_fire_control_radar_2
								fixed_engine = ship_perf_engine_4
								rear_1 = ship_light_medium_battery_4
								rear_2 = ship_anti_air_4
								mid_1 = ship_torpedo_2
								mid_3 = ship_torpedo_2
								mid_4 = ship_anti_air_4
								front_2 = ship_light_medium_battery_4
							}
							upgrades = {
								ship_medium_engine_upgrade = 8
								ship_medium_armor_upgrade = 4
							}
						}
					}
				}
				hidden_effect = { add_manpower = 1180 }
				create_ship = { type = ship_hull_cruiser_1 equipment_variant = "Sintra Class" creator = ITA name = "NRP Sintra" }
			}
			else_if = { #1944
				limit = {
					ITA = {
						has_tech = advanced_light_medium_battery
						has_tech = advanced_fire_control_system
						has_tech = improved_decimetric_radar
						has_tech = modern_perf_engines
						has_tech = antiair5
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = POR_1944_ITA_cruiser_purchased_flag }
					}
					set_country_flag = POR_1944_ITA_cruiser_purchased_flag
					ITA = {
						create_equipment_variant = {
							name = "Porto Class"
							type = ship_hull_cruiser_1
							name_group = ITA_CL_HISTORICAL
							parent_version = 0
							allow_without_tech = yes
							role_icon_index = 1
							modules = {
								fixed_front_1 = ship_light_medium_battery_4
								fixed_target_acquisition = ship_fire_control_system_3
								fixed_radar = ship_fire_control_radar_1
								fixed_engine = ship_perf_engine_4
								rear_1 = ship_light_medium_battery_4
								rear_2 = ship_anti_air_4
								mid_1 = ship_torpedo_2
								mid_3 = ship_torpedo_2
								mid_4 = ship_anti_air_4
								front_2 = ship_light_medium_battery_4
							}
							upgrades = {
								ship_medium_engine_upgrade = 8
								ship_medium_armor_upgrade = 4
							}
						}
					}
				}
				hidden_effect = { add_manpower = 1180 }
				create_ship = { type = ship_hull_cruiser_1 equipment_variant = "Porto Class" creator = ITA name = "NRP Porto" }
			}
			else_if = { #1940
				limit = {
					ITA = {
						has_tech = improved_light_medium_battery
						has_tech = improved_fire_control_system
						has_tech = improved_decimetric_radar
						has_tech = advanced_perf_engines
						has_tech = antiair2
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = POR_1940_ITA_cruiser_purchased_flag }
					}
					set_country_flag = POR_1940_ITA_cruiser_purchased_flag
					ITA = {
						create_equipment_variant = {
							name = "Loures Class"
							type = ship_hull_cruiser_1
							name_group = ITA_CL_HISTORICAL
							parent_version = 0
							allow_without_tech = yes
							role_icon_index = 1
							modules = {
								fixed_front_1 = ship_light_medium_battery_3
								fixed_target_acquisition = ship_fire_control_system_2
								fixed_radar = ship_fire_control_radar_1
								fixed_engine = ship_perf_engine_3
								rear_1 = ship_light_medium_battery_3
								rear_2 = ship_anti_air_3
								mid_1 = ship_torpedo_2
								mid_3 = ship_torpedo_2
								mid_4 = ship_anti_air_4
								front_2 = ship_light_medium_battery_3
							}
							upgrades = {
								ship_medium_engine_upgrade = 8
								ship_medium_armor_upgrade = 4
							}
						}
					}
				}
				hidden_effect = { add_manpower = 1180 }
				create_ship = { type = ship_hull_cruiser_1 equipment_variant = "Loures Class" creator = ITA name = "NRP Loures" }
			}
			else = { #Fallback
				if = {
					limit = {
						NOT = { has_country_flag = POR_1936_ITA_cruiser_purchased_flag }
					}
					set_country_flag = POR_1936_ITA_cruiser_purchased_flag
					ITA = {
						create_equipment_variant = {
							name = "Amadora Class"
							type = ship_hull_cruiser_1
							name_group = ITA_CL_HISTORICAL
							parent_version = 0
							role_icon_index = 1
							modules = {
								fixed_front_1 = ship_light_medium_battery_2
								fixed_target_acquisition = ship_fire_control_system_1
								fixed_engine = ship_perf_engine_2
								rear_1 = ship_light_medium_battery_2
								rear_2 = ship_anti_air_2
								mid_1 = ship_torpedo_2
								mid_3 = ship_torpedo_2
								mid_4 = ship_anti_air_4
								front_2 = ship_light_medium_battery_2
							}
							upgrades = {
								ship_medium_engine_upgrade = 8
								ship_medium_armor_upgrade = 4
							}
						}
					}
				}
				hidden_effect = { add_manpower = 1170 }
				create_ship = { type = ship_hull_cruiser_1 equipment_variant = "Amadora Class" creator = ITA name = "NRP Amadora" }
			}

			ITA = {
				add_offsite_building = {
					type = industrial_complex
					level = -1
				}
			}
			country_event = lar_portugal_purchase_ships.6
			set_country_flag = POR_ships_purchased_flag
			clr_country_flag = POR_purchase_italian_light_cruiser_flag
			clr_country_flag = POR_ships_purchase_in_progress_flag
		}
	}
}

POR_naval_blockade = {
	POR_evade_blockade_with_portuguese_convoys = {

		icon = generic_naval

		allowed = {
			NOT = { original_tag = POR }
		}

		visible = {
			POR = {
				has_completed_focus = POR_refuse_the_naval_blockade
			}
			NOT = { 
				has_country_flag = POR_evade_blockade_flag 
				has_country_flag = POR_cancel_evade_blockade_flag 
			}
		}
		
		available = {
			num_of_civilian_factories > 1
			POR = {
				has_navy_size = {
				    size > 49
				    type = convoy
				}
				has_opinion = { target = ROOT value > -10 }
			}
		}

		cost = 25
		fire_only_once = yes
		ai_will_do = {
			base = 1
		}

		cancel_trigger = {
			OR= {
				NOT = { has_war_with = ENG }
				has_war_with = POR
				has_country_flag = POR_cancel_evade_blockade_flag
				has_capitulated = yes
			}
		}

		days_remove = -1

		modifier = {
			civilian_factory_use = 1
		}

		#Fail
		cancel_effect = {
			add_war_support = -0.1
			POR = {
				add_equipment_to_stockpile = {
		            type = convoy_1
		            amount = 50
	       		}
				add_offsite_building = { type = industrial_complex  level = -1 }
			}
			set_country_flag = POR_cancel_evade_blockade_flag
			clr_country_flag = POR_evade_blockade_flag
		}

		#On Activation
		complete_effect = {
			add_war_support = 0.1
			set_country_flag = POR_evade_blockade_flag
			effect_tooltip = {
				POR = { 
					add_equipment_to_stockpile = {
			            type = convoy_1
			            amount = -50
		       		}
					add_offsite_building = { type = industrial_complex  level = 1 }
				}
			}
			hidden_effect=  { 
				POR = { 
					country_event = lar_portugal_naval_blockade.2 
					activate_targeted_decision = { 
						target = ROOT 
						decision = POR_portugal_cancel_blockade_evasion_for_country
					}
				}
			}
		}
	}

	POR_major_cancel_portuguese_blockade_evasion = {

		icon = generic_break_treaty

		available = {
			has_country_flag = POR_evade_blockade_flag
		}

		cost = 0
		fire_only_once = yes
		ai_will_do = {
			base = 0
			modifier = {
				add = 1
				num_of_civilian_factories < 6
			}
		}

		visible = {
			has_country_flag = POR_evade_blockade_flag
			NOT = { has_country_flag = POR_cancel_evade_blockade_flag }
		}

		complete_effect = {
			add_war_support = -0.1
			set_country_flag = POR_cancel_evade_blockade_flag
			clr_country_flag = POR_evade_blockade_flag
		}
	}

	POR_portugal_cancel_blockade_evasion_for_country = {

		icon = generic_break_treaty

		available = {
			always = yes
		}

		cost = 0
		fire_only_once = yes
		ai_will_do = {
			base = 0
			modifier = {
				add = 1
				OR = {
					has_equipment = {
					    convoy_1 < 5
					}
					AND = {
						has_opinion = { target = FROM value < -10 }
						NOT = { has_war_with = FROM }
					}
				}
			}
		}

		visible = {
			original_tag = POR
			country_exists = FROM
			FROM = {
           		has_country_flag = POR_evade_blockade_flag
           		NOT = { 
           			has_country_flag = POR_cancel_evade_blockade_flag
           			has_war_with = POR
           		}
           	}
		}		

		complete_effect = {
			FROM = {
				add_war_support = -0.1
				set_country_flag = POR_cancel_evade_blockade_flag
				clr_country_flag = POR_evade_blockade_flag
			}
		}
	}

}

POR_iberian_summit = {
	POR_iberian_summit_pro_axis = {
		icon = eng_trade_unions_support

		allowed = {
			OR = {
				original_tag = POR
				tag = SPA
			}
		}

		available = {		
			POR = { has_war = no }
			SPA = { has_war = no }
			NOT = { has_global_flag = POR_iberian_summit_in_progress_flag }
		}

		visible = {
			NOT = { has_global_flag = POR_iberian_summit_pro_axis_flag }
			country_exists = POR
			POR = { 
				is_in_faction = no
				has_completed_focus = POR_iberian_summit
				NOT = { has_government = communism }
				NOT = { has_government = democratic }
			}
			country_exists = SPA
			SPA = {
				is_in_faction = no
				OR = {
					has_completed_focus = SPA_the_phalanx_ascendant
					AND = {
						has_completed_focus = SPA_unify_the_nationalist_front
						NOT = { has_completed_focus = SPA_the_iberian_pact }
					}
				}
			}
			GER = { 
				is_faction_leader = yes 
				has_government = fascism
				has_capitulated = no
			}
		}

		cost = 50
		fire_only_once = yes
		days_remove = 1
		ai_will_do = {
			base = 0
			modifier = {
				add = 1
				has_completed_focus = POR_send_assistance
				OR = {
					GER = {
						has_war = yes 
						OR = {
							alliance_strength_ratio > 0.75
							any_war_score > 40
						}
					}
					has_opinion = { target = GER value > 0 }		
				}
			}
			modifier = {
				factor = 0
				is_historical_focus_on = yes
			}
		}

		complete_effect = {
			set_global_flag = POR_iberian_summit_pro_axis_flag
			set_global_flag = POR_iberian_summit_in_progress_flag
			set_country_flag = POR_iberian_summit_initiator_flag
			set_variable = { global.POR_iberian_summit_target = GER } 
			set_variable = { global.POR_iberian_summit_spanish_tag = SPA }
			if = {
				limit = {
					tag = POR
				}
				SPA = { 
					country_event = { id = lar_portugal_iberian_summit.1 hours = 18 random_hours = 6 }
				}
			}
			else = {
				POR = { 
					country_event = { id = lar_portugal_iberian_summit.1 hours = 18 random_hours = 6 } 
				}
			}
		}	
	}

	POR_iberian_summit_pro_allies = {
		icon = eng_trade_unions_support

		allowed = {
			OR = {
				original_tag = POR
				tag = SPA
				tag = SPD
			}
		}

		available = {		
			POR = { has_war = no }
			if = {
				limit = {
					country_exists = SPA #This is the prio
				}
				SPA = { has_war = no }
			}
			else = {
				SPD = { has_war = no }
			}
			NOT = { has_global_flag = POR_iberian_summit_in_progress_flag }
		}

		visible = {
			NOT = { has_global_flag = POR_iberian_summit_pro_allies_flag }
			country_exists = POR
			POR = {
				is_in_faction = no
				has_completed_focus = POR_iberian_summit
				NOT = { has_government = fascism }
				NOT = { has_government = communism }
			}
			if = {
				limit = {
					country_exists = SPA #This is the prio
				}
				SPA = {
					is_in_faction = no
					has_completed_focus = SPA_unify_the_nationalist_front
					NOT = { has_completed_focus = SPA_the_iberian_pact }
				}
			}
			else = {
				country_exists = SPD
				SPD = {
					is_in_faction = no
					has_completed_focus = SPR_maintain_the_second_republic
					has_government = democratic
				}
			}
			ENG = { 
				is_faction_leader = yes 
				has_government = democratic
				has_capitulated = no
			}
		}

		cost = 50
		fire_only_once = yes
		days_remove = 1
		ai_will_do = { 
			base = 0
			modifier = {
				add = 1
				POR = {
					has_completed_focus = POR_allow_free_elections
				}					
				OR = {
					ENG = {
						has_war = yes 
						OR = {
							alliance_strength_ratio > 0.75
							any_war_score > 40
						}
					}
					has_opinion = { target = ENG value > 0 }		
				}
			}
			modifier = {
				factor = 0
				is_historical_focus_on = yes
			}
		}

		complete_effect = {
			set_global_flag = POR_iberian_summit_pro_allies_flag
			set_global_flag = POR_iberian_summit_in_progress_flag
			set_country_flag = POR_iberian_summit_initiator_flag
			set_variable = { global.POR_iberian_summit_target = ENG }
			if = {
				limit = { country_exists = SPA }
				set_variable = { global.POR_iberian_summit_spanish_tag = SPA }
			} 
			else = {
				set_variable = { global.POR_iberian_summit_spanish_tag = SPD }
			}
			if = {
				limit = { tag = POR }
				41 = {
					owner = { country_event = { id = lar_portugal_iberian_summit.5 hours = 18 random_hours = 6 } }
				}
			}
			else = {
				POR = { 
					country_event = { id = lar_portugal_iberian_summit.5 hours = 18 random_hours = 6 }
				}
			}
		}	
	}
	#Timed Decision for delaying proposal
	POR_iberian_summit_proposal_delayed = {
		icon = generic_political_discourse
		
		allowed = {
			OR = {
				tag = POR
				tag = SPD
				tag = SPA
			}
		}

		visible = {
			has_global_flag = POR_iberian_summit_proposal_delayed_flag 
		}

		fire_only_once = no

		days_remove = 180

		modifier = {
			political_power_gain = -0.2
		}

		cancel_trigger = {
			OR = {
				NOT = { country_exists = global.POR_iberian_summit_target }
				var:global.POR_iberian_summit_target = { is_faction_leader = no }
				NOT = { country_exists = POR }
				POR = {
					OR = { 
						has_war = yes 
						is_in_faction = yes
					}
				}
				NOT = { country_exists = global.POR_iberian_summit_spanish_tag }
				var:global.POR_iberian_summit_spanish_tag = {
					OR = {
						has_war = yes
						is_in_faction = yes
					}
				}
			}
		}

		#On Activation
		complete_effect = {
			var:global.POR_iberian_summit_target = {
				add_opinion_modifier = {
					target = ROOT
					modifier = POR_iberian_summit_diplomatic_approach
				}
			}
		}

		#Fail
		cancel_effect = {
			remove_opinion_modifier = {	target = POR modifier = POR_iberian_summit_working_together	}
			var:global.POR_iberian_summit_target = {
				remove_opinion_modifier = { target = POR modifier = POR_iberian_summit_diplomatic_approach }
			}
			if = { 
				limit = { country_exists = SPA }
				remove_opinion_modifier = {	target = SPA modifier = POR_iberian_summit_working_together	}
				var:global.POR_iberian_summit_target = {
					remove_opinion_modifier = { target = SPA modifier = POR_iberian_summit_diplomatic_approach }
				}
			}
			else = {
				remove_opinion_modifier = {	target = SPD modifier = POR_iberian_summit_working_together	}
				var:global.POR_iberian_summit_target = {
					remove_opinion_modifier = { target = SPA modifier = POR_iberian_summit_diplomatic_approach }
				}
			}
			
			clr_global_flag = POR_iberian_summit_in_progress_flag
			clr_global_flag = POR_iberian_summit_proposal_delayed_flag
			clr_country_flag = POR_iberian_summit_initiator_flag  
			clear_variable = global.POR_iberian_summit_target
		}

		#Success
		remove_effect = {
			if = {
				limit = {
					has_country_flag = POR_iberian_summit_initiator_flag
				}
				if = {
					limit = {
						check_variable = {
						    var = global.POR_iberian_summit_target
						    value = GER
						    compare = equals
						}
					}
					var:global.POR_iberian_summit_target = { 
						country_event = { id = lar_portugal_iberian_summit.4 hours = 8 random_hours = 4 }
					}
				}
				else = {
					var:global.POR_iberian_summit_target = { 
						country_event = { id = lar_portugal_iberian_summit.8 hours = 8 random_hours = 4 }
					}
				}
			}
			clr_global_flag = POR_iberian_summit_in_progress_flag
			clr_global_flag = POR_iberian_summit_proposal_delayed_flag
			clr_country_flag = POR_iberian_summit_initiator_flag
		}
	}
}

POR_monarchist_cause = {

	POR_stir_monarchist_sentiment_in_brazil = {
		icon = generic_political_discourse

		allowed = {
			has_dlc = "La Resistance"
			original_tag = POR
		}

		available = {
			BRA = { 
				has_war = no 
			}
		}

		cost = 25
		fire_only_once = no

		ai_will_do = {
			base = 1
		}
		visible = {
			has_completed_focus = POR_a_royal_wedding
			NOT = { has_completed_focus = POR_the_empire_of_brazil }
			country_exists = BRA
		}

		cancel_trigger = {
			OR = {
				has_completed_focus = POR_the_empire_of_brazil
				has_war_with = BRA
				BRA = { neutrality < -0.15 }
			}
		}

		cancel_effect = {
			BRA = {
				clr_country_flag = POR_portugal_stirring_brazilian_monarchists_flag
				set_country_flag = POR_brazilian_monarchists_stirred_flag
			}
		}

		modifier = {
			political_power_gain = -0.5
		}
		days_remove = 180

		remove_effect = {
			BRA = {
				clr_country_flag = POR_portugal_stirring_brazilian_monarchists_flag
				set_country_flag = POR_brazilian_monarchists_stirred_flag
			}
		}

		complete_effect = {
			custom_effect_tooltip = POR_stir_monarchist_sentiment_in_brazil_tt
			BRA = { 
				activate_decision = POR_portugal_promoting_monarchist_cause_in_brazil
				set_country_flag = POR_portugal_stirring_brazilian_monarchists_flag 
				country_event = { id = lar_portugal_promote_monarchist_cause.1 }
			}
		}
	}

	#Mission for BRA when POR starts promoting monarchist cause in BRA.
	POR_portugal_promoting_monarchist_cause_in_brazil = {
		icon = generic_civil_support

		allowed = {
			has_dlc = "La Resistance"
			original_tag = BRA
		}

		visible = {
			has_country_flag = POR_portugal_stirring_brazilian_monarchists_flag
		}

		cancel_trigger = {
			OR = {
				NOT = { has_country_flag = POR_portugal_stirring_brazilian_monarchists_flag }
				POR = { has_completed_focus = POR_the_empire_of_brazil }
				neutrality < -0.15
				has_war_with = POR
			}
		}

		fire_only_once = no

		modifier = {
			neutrality_drift = 0.1
			stability_weekly = -0.01
		}

		days_remove = 180
	}

	#Decision for BRA to fight brazilian monarchists
	POR_repress_brazilian_monarchists = {
		icon = oppression

		allowed = {
			has_dlc = "La Resistance"
			original_tag = BRA
		}

		available = {
			neutrality < 1
		}

		cost = 25
		fire_only_once = no

		ai_will_do = {
			factor = 0
		}
		visible = {
			OR = {
				has_country_flag = POR_portugal_stirring_brazilian_monarchists_flag
				has_country_flag = POR_brazilian_monarchists_stirred_flag
			}
			country_exists = POR
			POR = { NOT = { has_completed_focus = POR_the_empire_of_brazil } }		
		}

		cancel_trigger = {
			POR = { has_completed_focus = POR_the_empire_of_brazil }
		}

		modifier = {
			stability_factor = -0.05
			political_power_gain  = -0.5
			neutrality_drift = -0.1
		}

		days_remove = 180

		remove_effect = {
			clr_country_flag = POR_brazilian_monarchists_stirred_flag
		}
	}

	#Decision to boost unaligned popularity in Portugal 
	POR_stir_monarchist_sentiment_in_portugal = {
		icon = generic_political_discourse

		allowed = {
			has_dlc = "La Resistance"
			original_tag = POR
		}

		available = {
			neutrality < 1
		}

		cost = 25
		fire_only_once = no

		ai_will_do = {
			base = 1
		}
		visible = {
			has_completed_focus = POR_a_royal_wedding
			NOT = { has_completed_focus = POR_restoration_of_the_monarchy }
		}

		cancel_trigger = {
			has_completed_focus = POR_restoration_of_the_monarchy
		}

		modifier = {
			political_power_gain = -0.5
			neutrality_drift = 0.1
			stability_weekly = -0.01
		}
		days_remove = 180
	}
}

POR_prospect_for_resources = {
	POR_develop_lisbon_tungsten_deposits = { #112
		
		icon = tungsten

		allowed = {

		}

		highlight_states = {
 highlight_state_targets = {
			state = 112
		} 
}

		available = {
			has_completed_focus = POR_extraction_industries
			num_of_civilian_factories_available_for_projects > 2
			owns_state = 112
			controls_state = 112
		}

		visible = {
			owns_state = 112
			controls_state = 112
			112 = {
				NOT = {	has_state_flag = POR_lisbon_tungsten_developed_flag }
			}
		}

		cost = 25
		days_remove = 90
		fire_only_once = yes

		modifier = {
			civilian_factory_use = 3
		}

		remove_effect = {
			112 = {	set_state_flag = POR_lisbon_tungsten_developed_flag }
			112 = {
				add_resource = {
					type = tungsten
					amount = 10
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				has_political_power < 200
				factor = 0
			}
		}
	}

	POR_develop_santarem_chromium_deposits = { #795
		
		icon = chromium

		allowed = {

		}

		highlight_states = {
 highlight_state_targets = {
			state = 795
		} 
}

		available = {
			has_completed_focus = POR_extraction_industries
			num_of_civilian_factories_available_for_projects > 1
			owns_state = 795
			controls_state = 795
		}

		visible = {
			owns_state = 795
			controls_state = 795
			795 = {
				NOT = {
					has_state_flag = { 
						flag = POR_santarem_chromium_developed_flag
						value = 5
					}
				}
			}
		}

		cost = 25
		days_remove = POR_santarem_chromium_duration

		modifier = {
			civilian_factory_use = 1
		}

		remove_effect = {
			add_to_variable = { var = POR_santarem_chromium_duration value = 30 }
			795 = {
				if = {
					limit = {
						NOT = {
							has_state_flag = POR_santarem_chromium_developed_flag
						}
					}
					set_state_flag = {
						flag = POR_santarem_chromium_developed_flag
						value = 1
					}
				}
				else = {
					modify_state_flag = {
						flag = POR_santarem_chromium_developed_flag
						value = 1
					}
				}
			}
			795 = {
				add_resource = {
					type = chromium
					amount = 2
				}
			}
		}

		ai_will_do = {
			factor = 1
			modifier = {
				has_political_power < 200
				factor = 0
			}
		}

		complete_effect = {
			if = {
				limit = {
					check_variable = { var = POR_santarem_chromium_duration value = 30 compare = less_than }
				}
				set_variable = { var = POR_santarem_chromium_duration value = 15 }
			}
		}
	}
}


POR_the_spanish_civil_war = {
	POR_fight_alongside_the_republic = {
		icon = generic_prepare_civil_war

		available = {
			has_manpower > 10000
			has_stability > 0.5
			OR = {
				AND = {
					country_exists = SPA
					NOT = { has_war_with = SPA }
				}
				AND = {
					country_exists = SPC
					NOT = { has_war_with = SPC }
				}
				AND = {
					country_exists = SPB
					NOT = { has_war_with = SPB }
				}
			}
		}

		cost = 0
		fire_only_once = yes

		ai_will_do = {
			factor = 1
			modifier = {
				OR = {
					has_stability < 0.3
					has_manpower < 50000
				}
				factor = 0
			}
		}

		visible = {
			SPR_scw_in_progress = yes
			country_exists = SPD
			NOT = { has_war_with = SPD }
			has_completed_focus = POR_they_need_our_help
		}
		complete_effect = {
			hidden_effect = {
				set_country_flag = supports_SPD_flag
			}	
			if = {
				limit = { country_exists = SPA }
				add_to_war = { targeted_alliance = SPD enemy = SPA hostility_reason = asked_to_join }
			}
			if = {
				limit = { country_exists = SPC }
				add_to_war = { targeted_alliance = SPD enemy = SPC hostility_reason = asked_to_join }
			}
			if = {
				limit = { country_exists = SPB }
				add_to_war = { targeted_alliance = SPD enemy = SPB hostility_reason = asked_to_join }
			}
			effect_tooltip = {
				give_military_access = SPD
				SPD = { give_military_access = ROOT }
			}
			hidden_effect = {
				diplomatic_relation = {
					country = SPD
					relation = military_access
					active = yes
				}
				SPD = {
					diplomatic_relation = {
						country = POR
						relation = military_access
						active = yes
					}
				}
			}
		}
	}

	POR_fight_alongside_the_nationalists = {
		icon = generic_prepare_civil_war

		available = {
			has_manpower > 10000
			has_stability > 0.5
			OR = {
				AND = {
					country_exists = SPD
					NOT = { has_war_with = SPD }
				}
				AND = {
					country_exists = SPC
					NOT = { has_war_with = SPC }
				}
				AND = {
					country_exists = SPB
					NOT = { has_war_with = SPB }
				}
			}
		}

		cost = 0
		fire_only_once = yes

		ai_will_do = {
			factor = 1
			modifier = {
				OR = {
					has_stability < 0.3
					has_manpower < 50000
				}
				factor = 0
			}
		}

		visible = {
			SPR_scw_in_progress = yes
			country_exists = SPA
			NOT = { has_war_with = SPA }
			has_completed_focus = POR_send_assistance
		}
		complete_effect = {
			hidden_effect = {
				set_country_flag = supports_SPA_flag
			}	
			if = {
				limit = { country_exists = SPD }
				add_to_war = { targeted_alliance = SPA enemy = SPD hostility_reason = asked_to_join }
			}
			if = {
				limit = { country_exists = SPC }
				add_to_war = { targeted_alliance = SPA enemy = SPC hostility_reason = asked_to_join }
			}
			if = {
				limit = { country_exists = SPB }
				add_to_war = { targeted_alliance = SPA enemy = SPB hostility_reason = asked_to_join }
			}
			effect_tooltip = {
				give_military_access = SPA
				SPA = { give_military_access = ROOT }
			}
			hidden_effect = {
				diplomatic_relation = {
					country = SPA
					relation = military_access
					active = yes
				}
				SPA = {
					diplomatic_relation = {
						country = POR
						relation = military_access
						active = yes
					}
				}
			}
		}
	}

	POR_fight_alongside_the_carlists = {
		icon = generic_prepare_civil_war

		available = {
			has_manpower > 10000
			has_stability > 0.5
			OR = {
				AND = {
					country_exists = SPD
					NOT = { has_war_with = SPD }
				}
				AND = {
					country_exists = SPC
					NOT = { has_war_with = SPC }
				}
				AND = {
					country_exists = SPA
					NOT = { has_war_with = SPA }
				}
			}
		}

		cost = 0
		fire_only_once = yes

		ai_will_do = {
			factor = 1
			modifier = {
				OR = {
					has_stability < 0.3
					has_manpower < 50000
				}
				factor = 0
			}
		}

		visible = {
			SPR_scw_in_progress = yes
			country_exists = SPB
			NOT = { has_war_with = SPB }
			has_completed_focus = POR_join_the_carlist_fight
		}
		complete_effect = {
			hidden_effect = {
				set_country_flag = supports_SPB_flag
			}	
			if = {
				limit = { country_exists = SPD }
				add_to_war = { targeted_alliance = SPB enemy = SPD hostility_reason = asked_to_join }
			}
			if = {
				limit = { country_exists = SPC }
				add_to_war = { targeted_alliance = SPB enemy = SPC hostility_reason = asked_to_join }
			}
			if = {
				limit = { country_exists = SPA }
				add_to_war = { targeted_alliance = SPB enemy = SPA hostility_reason = asked_to_join }
			}
			effect_tooltip = {
				give_military_access = SPB
				SPB = { give_military_access = ROOT }
			}
			hidden_effect = {
				diplomatic_relation = {
					country = SPB
					relation = military_access
					active = yes
				}
				SPB = {
					diplomatic_relation = {
						country = POR
						relation = military_access
						active = yes
					}
				}
			}
		}
	}
}
